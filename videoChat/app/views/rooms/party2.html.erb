<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title><%= @room.name %></title>
</head>

<body>

  <div id='subscribersDiv'></div> 
  <div id='myPublisherDiv'></div>
  <script src='https://static.opentok.com/v2/js/opentok.min.js', type="text/javascript"></script> 
  <script>
    var apiKey = "<%= @apiKey %>";
    var sessionId = "<%= @room.sessionId %>";
    var token = "<%= @tok_token %>";
      var session = OT.initSession(apiKey, sessionId); 
      session.connect(token, function(error) {
        if (error) {
        }   
        else {
          var publisherProperties = {resolution: '320x240'};
          var publisher = OT.initPublisher("myPublisherDiv", publisherProperties);
          session.publish(); 
        }
      });
            
      session.on({streamCreated: function(event) { 
               
        subscriber = session.subscribe(event.stream, 'subscribersDiv', {insertMode: 'append'});
      }});
    }       
  </script>
</body>
</html>
